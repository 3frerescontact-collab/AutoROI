import os
import logging
from dotenv import load_dotenv
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, CallbackQueryHandler, MessageHandler, filters, ContextTypes

# Charger les variables d'environnement
load_dotenv()
TOKEN = os.getenv("TELEGRAM_TOKEN")
CHAT_ID = os.getenv("TELEGRAM_CHAT_ID")

# Activer les logs
logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO)

# Stockage des crit√®res par d√©faut
user_criteria = {
    "marque": "BMW",
    "modele": "530d",
    "prix_max": 25000,
    "annee_min": 2017,
    "km_max": 120000,
    "frais_import": 1500,
    "frais_vente": 500
}

# -----------------------
# Fonctions principales
# -----------------------

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """D√©marre le bot"""
    await update.message.reply_text(
        f"üöó Bonjour M. Garin,\nBienvenue sur AutoROI.\n\n"
        f"Utilisez /menu pour modifier vos crit√®res.\n"
        f"Utilisez /runonce pour voir les 10 meilleures annonces simul√©es."
    )

async def show_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Affiche le menu principal"""
    keyboard = [
        [InlineKeyboardButton("Marque", callback_data="edit_marque"),
         InlineKeyboardButton("Mod√®le", callback_data="edit_modele")],
        [InlineKeyboardButton("Prix max (‚Ç¨)", callback_data="edit_prix"),
         InlineKeyboardButton("Ann√©e min", callback_data="edit_annee")],
        [InlineKeyboardButton("Km max", callback_data="edit_km")],
        [InlineKeyboardButton("Frais import (‚Ç¨)", callback_data="edit_import"),
         InlineKeyboardButton("Frais vente (‚Ç¨)", callback_data="edit_vente")],
        [InlineKeyboardButton("‚úÖ Voir annonces simul√©es", callback_data="show_ads")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text("‚öôÔ∏è Choisissez un crit√®re √† modifier :", reply_markup=reply_markup)

# -----------------------
# √âdition des crit√®res
# -----------------------
import os
import logging
from dotenv import load_dotenv
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, CallbackQueryHandler, MessageHandler, filters, ContextTypes

# Charger les variables d'environnement
load_dotenv()
TOKEN = os.getenv("TELEGRAM_TOKEN")
CHAT_ID = os.getenv("TELEGRAM_CHAT_ID")

# Activer les logs
logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO)

# Stockage des crit√®res par d√©faut
user_criteria = {
    "marque": "BMW",
    "modele": "530d",
    "prix_max": 25000,
    "annee_min": 2017,
    "km_max": 120000,
    "frais_import": 1500,
    "frais_vente": 500
}

# -----------------------
# Fonctions principales
# -----------------------

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """D√©marre le bot"""
    await update.message.reply_text(
        f"üöó Bonjour M. Garin,\nBienvenue sur AutoROI.\n\n"
        f"Utilisez /menu pour modifier vos crit√®res.\n"
        f"Utilisez /runonce pour voir les 10 meilleures annonces simul√©es."
    )

async def show_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Affiche le menu principal"""
    keyboard = [
        [InlineKeyboardButton("Marque", callback_data="edit_marque"),
         InlineKeyboardButton("Mod√®le", callback_data="edit_modele")],
        [InlineKeyboardButton("Prix max (‚Ç¨)",]()
